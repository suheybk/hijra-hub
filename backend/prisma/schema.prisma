generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id        String   @id @default(uuid())
  phone     String   @unique
  email     String?  @unique
  fullName  String?
  role      String   @default("BUYER") // Enum: BUYER, SELLER, ADMIN, BROKER
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  properties     Property[]
  leads          Lead[]     @relation("BuyerLeads")
  receivedLeads  Lead[]     @relation("SellerLeads")
}

model Property {
  id          String   @id @default(uuid())
  title       String
  description String
  price       Float
  currency    String   @default("SAR")
  location    Json     // Store { lat, lng, address }
  type        String   // Enum: APARTMENT, VILLA, LAND, COMMERCIAL
  features    Json?    // Array of strings or object
  images      String   // Stored as JSON string or CSV
  
  ownerId     String
  owner       User     @relation(fields: [ownerId], references: [id])
  
  status      String   @default("DRAFT") // Enum: DRAFT, PUBLISHED, SOLD, ARCHIVED
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  leads       Lead[]
}

model Lead {
  id        String   @id @default(uuid())
  status    String   @default("NEW") // NEW, CONTACTED, CLOSED
  message   String?
  
  buyerId   String
  buyer     User     @relation("BuyerLeads", fields: [buyerId], references: [id])
  
  sellerId  String
  seller    User     @relation("SellerLeads", fields: [sellerId], references: [id])
  
  propertyId String?
  property   Property? @relation(fields: [propertyId], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ServicePackage {
  id          String   @id @default(uuid())
  name        String
  description String
  price       Float
  type        String   // JOB, RESIDENCY, CONSULTATION
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
